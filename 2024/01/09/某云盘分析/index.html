<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta name="renderer" content="webkit"/>
    <meta name="force-rendering" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <script>if (/*@cc_on!@*/false || (!!window.MSInputMethodContext && !!document.documentMode)) window.location.href="https://support.dmeng.net/upgrade-your-browser.html?referrer="+encodeURIComponent(window.location.href); </script>
    
    
        <link rel="preload" crossorigin="crossorigin" href="/fonts/roboto/Roboto-Regular.woff2" as="font">
        <link rel="preload" crossorigin="crossorigin" href="/fonts/roboto/Roboto-Bold.woff2" as="font">
    
    
    
        <link rel="shortcut icon" href="/icons/favicon.ico">
    

    
    
        
<link rel="stylesheet" href="/css/mdui.min.v1.0.0.css">

    
    
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/iconfont.css">


    
    

    
        <script data-ad-client="ca-" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    












          


    
    
    <title>
        
            某云盘分析 | Hexo
        
    </title>
    
    
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head>
<body class="mdui-drawer-body-left mdui-appbar-with-toolbar mdui-theme-primary-teal mdui-theme-accent-blue">
  
  <header class="mdui-appbar mdui-appbar-fixed">
  <div id="toolbar" class="mdui-toolbar mdui-color-theme">
    <button class="mdui-btn mdui-btn-icon" mdui-drawer="{target: '#sidebar', swipe: true}"><i class="iconfont icon-menu"></i></button>
    <a href="/" class="mdui-typo-headline">Hexo</a>
    <a href="/" class="header-subtitle mdui-typo-headline"></a>
    <div class="mdui-toolbar-spacer"></div>
    <button class="mdui-btn mdui-btn-icon" mdui-dialog="{target: '#search'}" mdui-tooltip="{content: 'search'}"><i class="iconfont icon-search"></i></button>
  </div>
</header>

<div class="mdui-dialog" id="search">
  
    <div class="search-form">
      <input type="search" class="search-form-input" placeholder="请输入关键字" onfocus="listenSearchFunc()">
    </div>
    <div class="search-result" data-resource="/search.xml"></div>
  
</div>

  <aside id="sidebar" class="mdui-drawer">
    <div class="mdui-tab" mdui-tab>
        <a href="#sidebar-tab1" id="sidebartab" class="mdui-ripple mdui-tab-active">Overview</a>
        <a href="#sidebar-tab2" id="sidebartab" class="mdui-ripple">About</a>
    </div>

    
    <div id="sidebar-tab1" class="mdui-p-a-1">
        <div class="mdui-list">
            
                
                <a href="/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-home"></i>
                    </div>
                    <div class="mdui-list-item-content">Home</div>
                </a>
            
                
                <a href="/tags/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-bookmark"></i>
                    </div>
                    <div class="mdui-list-item-content">Tags</div>
                </a>
            
                
                <a href="/categories/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-folder"></i>
                    </div>
                    <div class="mdui-list-item-content">Categories</div>
                </a>
            
                
                <a href="/archives/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-archive"></i>
                    </div>
                    <div class="mdui-list-item-content">Archives</div>
                </a>
            
                
                <a href="/about/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-user"></i>
                    </div>
                    <div class="mdui-list-item-content">About</div>
                </a>
            
            <div class="mdui-list-item mdui-ripple">
                <div class="mdui-list-item-icon">
                    <i class="iconfont icon-moon"></i>
                </div>
                <div class="mdui-list-item-content">Night Mode</div>
                <label class="mdui-switch" id="darkmode">
                  <input type="checkbox" id="nightmode_switch"/>
                  <i class="mdui-switch-icon"></i>
                </label>
            </div>           
        </div>
    </div>

    
    <div id="sidebar-tab2" class="mdui-p-a-1">
        <div class="sidebar-overview">
            <div class="sidebar-avatar">
                
                    <img src="/icons/tx.jpg"/>
                
            </div>
            <div class="sidebar-author-name">l0ck</div>
            <div class="sidebar-description">我本将心向明月</div>
        </div>
        <div class="sidebar-links">
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="iconfont icon-mail"></i></span>
                    <a href="mailto:2499086884@qq.com" class="mdui-chip-title">E-Mail</a>
                </div>
            
        </div>
        <ul class="mdui-list" mdui-collapse="{accordion: true}">
            <li class="mdui-collapse-item">
                <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-link"></i>
                    </div>
                    <div class="mdui-list-item-content">Links</div>
                    <div class="mdui-collapse-item-arrow">
                        <i class="mdui-list-item-icon iconfont icon-angle-down"></i>
                    </div>
                </div>
                <ul id="linksList" class="mdui-collapse-item-body mdui-list mdui-list-dense">
                    
                        <a target="_blank" rel="noopener" href="https://military-axe.github.io/" class="mdui-list-item mdui-ripple">
                            炮哥
                        </a>
                    
                        <a target="_blank" rel="noopener" href="https://h0pe-ay.github.io/" class="mdui-list-item mdui-ripple">
                            hope
                        </a>
                    
                </ul>
            </li>
        </ul>
    </div>

    <div class="mdui-divider"></div>
    
    
</aside>
  
  <main id="main-contain" class="mdui-container mdui-m-t-5">
    <article id="article" class="mdui-card mdui-p-b-2 mdui-m-b-5">
  <header class="mdui-card-media">
    
    
      <div class="post-header"> 
  <a class="post-header-title" href="/2024/01/09/%E6%9F%90%E4%BA%91%E7%9B%98%E5%88%86%E6%9E%90/">某云盘分析</a>
  <div class="post-header-meta">
    <span>
      <span class="iconfont icon-calendar"></span>
      Posted on:&nbsp;2024-01-09
    </span>
    <span>
      <span class="iconfont icon-calendar-check"></span>
      Edited on:&nbsp;2024-03-14
    </span>
    <span>
      <span class="iconfont icon-folder"></span>
      In:&nbsp;
    </span>
    
      <span>
        <span class="iconfont icon-eye"></span>
        Views:&nbsp;
        <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
      </span>
    
  </div>
</div>   
    



    
    
    <div class="mdui-card-menu">
    
      <button class="mdui-btn mdui-btn-icon mdui-text-color-teal" mdui-menu="{target: '#share_menu', align: 'right'}"><i class="iconfont icon-share"></i></button>
      <ul class="mdui-menu" id="share_menu">
        <li class="mdui-menu-item">
          <a href="http://service.weibo.com/share/share.php?appkey=&title=某云盘分析&url=http://example.com/2024/01/09/%E6%9F%90%E4%BA%91%E7%9B%98%E5%88%86%E6%9E%90/&pic=http://example.com/null&searchPic=false&style=simple" target="_blank" class="mdui-ripple">Share to Weibo</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://twitter.com/intent/tweet?text=某云盘分析&url=http://example.com/2024/01/09/%E6%9F%90%E4%BA%91%E7%9B%98%E5%88%86%E6%9E%90/&via=John Doe" target="_blank" class="mdui-ripple">Share to Twitter</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://www.facebook.com/sharer/sharer.php?u=http://example.com/2024/01/09/%E6%9F%90%E4%BA%91%E7%9B%98%E5%88%86%E6%9E%90/" target="_blank" class="mdui-ripple">Share to Facebook</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://plus.google.com/share?url=http://example.com/2024/01/09/%E6%9F%90%E4%BA%91%E7%9B%98%E5%88%86%E6%9E%90/" target="_blank" class="mdui-ripple">Share to Google+</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://example.com/2024/01/09/%E6%9F%90%E4%BA%91%E7%9B%98%E5%88%86%E6%9E%90/&title=某云盘分析" target="_blank" class="mdui-ripple">Share to LinkedIn</a>
        </li>
        <li class="mdui-menu-item">
          <a href="http://connect.qq.com/widget/shareqq/index.html?site=Hexo&title=某云盘分析&summary=&pics=http://example.com/null&url=http://example.com/2024/01/09/%E6%9F%90%E4%BA%91%E7%9B%98%E5%88%86%E6%9E%90/" target="_blank" class="mdui-ripple">Share to QQ</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://telegram.me/share/url?url=http://example.com/2024/01/09/%E6%9F%90%E4%BA%91%E7%9B%98%E5%88%86%E6%9E%90/&text=某云盘分析" target="_blank" class="mdui-ripple">Share to Telegram</a>
        </li>
      </ul>
    
  </div>
  </header>
  
  
  
  
  
  <div class="mdui-card-content mdui-typo mdui-p-x-4">
    <h1 id="1-攻击面分析"><a href="#1-攻击面分析" class="headerlink" title="1.攻击面分析"></a>1.攻击面分析</h1><p>扫描所有的TCP端口</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">$ nmap -A -p- 192.168.124.14</span><br><span class="line">Starting Nmap 7.93 ( https://nmap.org ) at 2023-08-13 19:53 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.124.14</span><br><span class="line">Host is up (0.035s latency).</span><br><span class="line">Not shown: 65522 closed tcp ports (conn-refused)</span><br><span class="line">PORT      STATE SERVICE     VERSION</span><br><span class="line">80/tcp    open  http        nginx 1.16.1</span><br><span class="line">|_http-server-header: nginx/1.16.1</span><br><span class="line">|_http-title: 403 Forbidden</span><br><span class="line">111/tcp   open  rpcbind     2 (RPC <span class="comment">#100000)</span></span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version    port/proto  service</span><br><span class="line">|   100000  2            111/tcp   rpcbind</span><br><span class="line">|_  100000  2            111/udp   rpcbind</span><br><span class="line">139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">443/tcp   open  ssl/http    nginx 1.16.1</span><br><span class="line">|_http-server-header: nginx/1.16.1</span><br><span class="line">| tls-nextprotoneg: </span><br><span class="line">|_  http/1.1</span><br><span class="line">|_ssl-<span class="built_in">date</span>: TLS randomness does not represent time</span><br><span class="line">| ssl-cert: Subject: organizationName=Internet Widgits Pty Ltd/stateOrProvinceName=Some-State/countryName=AU</span><br><span class="line">| Not valid before: 2021-11-01T08:48:38</span><br><span class="line">|_Not valid after:  2021-12-01T08:48:38</span><br><span class="line">| tls-alpn: </span><br><span class="line">|_  http/1.1</span><br><span class="line">|_http-title: 403 Forbidden</span><br><span class="line">445/tcp   open  netbios-ssn Samba smbd 4.6.11 (workgroup: WORKGROUP)</span><br><span class="line">1883/tcp  open  mqtt?</span><br><span class="line">| mqtt-subscribe: </span><br><span class="line">|_  ERROR: </span><br><span class="line">6900/tcp  open  http        nginx 1.16.1</span><br><span class="line">|_http-title: 502 Bad Gateway</span><br><span class="line">|_http-server-header: nginx/1.16.1</span><br><span class="line">6901/tcp  open  http        nginx 1.16.1</span><br><span class="line">|_http-server-header: nginx/1.16.1</span><br><span class="line">|_http-title: Site doesn<span class="string">&#x27;t have a title (text/debug).</span></span><br><span class="line"><span class="string">7000/tcp  open  http        nginx 1.16.1</span></span><br><span class="line"><span class="string">|_http-title: Site doesn&#x27;</span>t have a title (text/debug).</span><br><span class="line">|_http-server-header: nginx/1.16.1</span><br><span class="line">16800/tcp open  ssl/http    nginx 1.16.1</span><br><span class="line">| tls-nextprotoneg: </span><br><span class="line">|_  http/1.1</span><br><span class="line">|_ssl-<span class="built_in">date</span>: TLS randomness does not represent time</span><br><span class="line">|_http-server-header: nginx/1.16.1</span><br><span class="line">|_http-title: 502 Bad Gateway</span><br><span class="line">| ssl-cert: Subject: organizationName=Internet Widgits Pty Ltd/stateOrProvinceName=Some-State/countryName=AU</span><br><span class="line">| Not valid before: 2021-11-01T08:48:38</span><br><span class="line">|_Not valid after:  2021-12-01T08:48:38</span><br><span class="line">| tls-alpn: </span><br><span class="line">|_  http/1.1</span><br><span class="line">16900/tcp open  ssl/http    nginx 1.16.1</span><br><span class="line">| tls-nextprotoneg: </span><br><span class="line">|_  http/1.1</span><br><span class="line">|_ssl-<span class="built_in">date</span>: TLS randomness does not represent time</span><br><span class="line">| ssl-cert: Subject: organizationName=Internet Widgits Pty Ltd/stateOrProvinceName=Some-State/countryName=AU</span><br><span class="line">| Not valid before: 2021-11-01T08:48:38</span><br><span class="line">|_Not valid after:  2021-12-01T08:48:38</span><br><span class="line">| tls-alpn: </span><br><span class="line">|_  http/1.1</span><br><span class="line">|_http-server-header: nginx/1.16.1</span><br><span class="line">|_http-title: 502 Bad Gateway</span><br><span class="line">17000/tcp open  ssl/http    nginx 1.16.1</span><br><span class="line">|_http-server-header: nginx/1.16.1</span><br><span class="line">| tls-alpn: </span><br><span class="line">|_  http/1.1</span><br><span class="line">| tls-nextprotoneg: </span><br><span class="line">|_  http/1.1</span><br><span class="line">|_http-title: Site doesn<span class="string">&#x27;t have a title (text/debug).</span></span><br><span class="line"><span class="string">| ssl-cert: Subject: organizationName=Internet Widgits Pty Ltd/stateOrProvinceName=Some-State/countryName=AU</span></span><br><span class="line"><span class="string">| Not valid before: 2021-11-01T08:48:38</span></span><br><span class="line"><span class="string">|_Not valid after:  2021-12-01T08:48:38</span></span><br><span class="line"><span class="string">|_ssl-date: TLS randomness does not represent time</span></span><br><span class="line"><span class="string">20223/tcp open  unknown</span></span><br><span class="line"><span class="string">Service Info: Host: N1CLOUD</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Host script results:</span></span><br><span class="line"><span class="string">| smb2-time: </span></span><br><span class="line"><span class="string">|   date: 2016-09-30T16:08:46</span></span><br><span class="line"><span class="string">|_  start_date: N/A</span></span><br><span class="line"><span class="string">| smb-security-mode: </span></span><br><span class="line"><span class="string">|   account_used: guest</span></span><br><span class="line"><span class="string">|   authentication_level: user</span></span><br><span class="line"><span class="string">|   challenge_response: supported</span></span><br><span class="line"><span class="string">|_  message_signing: disabled (dangerous, but default)</span></span><br><span class="line"><span class="string">| smb-os-discovery: </span></span><br><span class="line"><span class="string">|   OS: Windows 6.1 (Samba 4.6.11)</span></span><br><span class="line"><span class="string">|   Computer name: n1cloud</span></span><br><span class="line"><span class="string">|   NetBIOS computer name: N1CLOUD\x00</span></span><br><span class="line"><span class="string">|   Domain name: \x00</span></span><br><span class="line"><span class="string">|   FQDN: n1cloud</span></span><br><span class="line"><span class="string">|_  System time: 2016-10-01T00:08:42+08:00</span></span><br><span class="line"><span class="string">|_nbstat: NetBIOS name: N1CLOUD, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 000000000000 (Xerox)</span></span><br><span class="line"><span class="string">| smb2-security-mode: </span></span><br><span class="line"><span class="string">|   311: </span></span><br><span class="line"><span class="string">|_    Message signing enabled but not required</span></span><br><span class="line"><span class="string">|_clock-skew: mean: -2507d22h26m57s, deviation: 4h37m07s, median: -2507d19h46m58s</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span></span><br><span class="line"><span class="string">Nmap done: 1 IP address (1 host up) scanned in 163.26 seconds</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p>由于UDP端口扫描太慢，所以暂且就不分析了，由TCP扫描的结果可以看出，开放了许多大端口，也就是有相当多的自定义服务，给我们提供了相当多的攻击面。</p>
<h1 id="2-固件获取"><a href="#2-固件获取" class="headerlink" title="2.固件获取"></a>2.固件获取</h1><p>固件获取的方法通常为官网下载，但对于这款设备，我们无法从官网上获得其固件更新包，这种情况下我们一般有两种选择：抓取升级流量和通过串口提取固件。</p>
<h1 id="3-固件分析"><a href="#3-固件分析" class="headerlink" title="3.固件分析"></a>3.固件分析</h1><p>使用binwalk查看固件</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230809144741433.png"></p>
<p>一个很典型的嵌入式Linux类别的固件，binwalk显示了Linux内核映像以及设备树，最后是squashfs的文件系统。</p>
<p>然后直接binwalk -Me一把梭</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230809145718454.png" alt="image-20230809145718454"></p>
<p>得到这样的结果，直接去看squashfs-root这个文件夹，因为这里面存储的就是设备运行的各个文件</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230809145835310.png" alt="image-20230809145835310"></p>
<p>ls可以看到非常多的文件夹，那么这么多的文件夹&#x2F;文件，我们该从哪里入手？</p>
<h2 id="嵌入式Linux的启动流程"><a href="#嵌入式Linux的启动流程" class="headerlink" title="嵌入式Linux的启动流程"></a>嵌入式Linux的启动流程</h2><p>这里就需要谈一谈嵌入式Linux的启动流程了</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230809150757692.png" alt="image-20230809150757692"></p>
<p>上面是一个嵌入式Linux设备的典型架构，固件最开始是bootloader，然后跟着bootloader的启动参数，之后就是kernel以及文件系统。</p>
<p>我上面图中的bootloader实际上包含两个部分：bootloader和boot，bootloader用于引导执行boot，这个boot可以是厂商自己设计的，也可以是使用的开源的boot，比如u-boot。u-boot在系统上电以后，他会完成下面几个重要的任务：</p>
<ul>
<li>初始化相关的硬件组件</li>
<li>初始化系统内存，准备将系统的控制权交给相应的系统</li>
<li>分配系统的资源</li>
<li>提供相应的机制，用于定位和加载系统镜像</li>
<li>加载操作系统，并将控制权移交给操作系统</li>
</ul>
<p>这个过程其实就是一些底层硬件初始化的工作，包括包括串行通信端口的配置，内部时钟配置以及一些子硬件系统（I2C、DRAM、Flash、网络子系统等）的配置。另外，U-boot有一个控制台模式，它会等待用户一段时间，等待用户给他一个信息（回车），让他进入控制台模式。如果等待的时间过了用户没有任何操作，系统就继续往下走了。</p>
<p>在U-boot完成初始化工作以后，它剩下的唯一工作就是<strong>加载并启动linux操作系统内核</strong>。当U-boot开始加载指定物理地址的操作系统内核以后，U-boot引导装入程序的使命就到此结束了，接下来系统由linux内核接管。</p>
<p><strong>当linux内核开始启动以后，开始打印各种设备信息，此时做的工作就是对各个外设进行驱动初始化</strong>，让他们各就各位。在执行完这些操作以后就要开始<strong>挂载根文件系统</strong>了。</p>
<h3 id="什么是文件系统？"><a href="#什么是文件系统？" class="headerlink" title="什么是文件系统？"></a>什么是文件系统？</h3><p>我们在Linux下看到的目录结构</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230809153031767.png" alt="image-20230809153031767"></p>
<p>实际上就是文件系统。</p>
<p>我们所有的文件都是存储在磁盘中的数据，但如果让我们人工直接去磁盘里面找数据那就有点难为人了。因此文件系统是被开发用于管理磁盘的软件系统，文件在磁盘中的存储位置，寻找方式以及属性等等都由文件系统决定。功能这么重要的软件自然不会只有一种，不同操作系统不同场景使用的文件系统都有差别。</p>
<p>在我们使用的Linux机器中，一般使用ext3和ext4的文件系统：</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230809154912300.png" alt="image-20230809154912300"></p>
<p>ext4是基于磁盘的文件系统，但我们的嵌入式设备通常是用不到磁盘来进行文件存储的，嵌入式设备使用的存储设备一般闪存(flash)，闪存主要有NOR和NAND两种技术。在顺手介绍下NOR FLASH和NAND FLASH的区别：</p>
<p><strong>NOR Flash的读取和我们常见的SDRAM的读取是一样，</strong>用户可以直接运行装载在NOR FLASH里面的代码，这样可以减少SRAM的容量从而节约了成本；<strong>NAND Flash</strong>没有采取内存的随机读取技术，它的读取是以一次读取一块的形式来进行的，通常是一次读取512个字节，采用这种技术的Flash比较廉价。用户不能直接运行NAND Flash上的代码，因此好多使用NAND Flash的开发板除了使用NAND Flash以外，还加上了一块小的NOR Flash来运行启动代码。</p>
<p>由于Flash存储器的擦写次数是有限的，NAND闪存还有特殊的硬件接口和读写时序。因此，必须针对Flash的硬件特性设计符合应用要求的文件系统；传统的文件系统如ext2等，用作Flash的文件系统会有诸多弊端。</p>
<p>针对于flash的文件系统也有很多类别：</p>
<ul>
<li>jffs2：主要用于NOR型闪存，缺点主要是当文件系统已满或接近满时，因为垃圾收集的关系而使jffs2的运行速度大大放慢。</li>
<li>yaffs&#x2F;yaffs2：用于NAND型闪存，yaffs与yaffs2的主要区别在于，前者仅支持小页(512 Bytes) NAND闪存，后者则可支持大页(2KB) NAND闪存。同时，yaffs2在内存空间占用、垃圾回收速度、读&#x2F;写速度等方面均有大幅提升。</li>
<li>squashfs：无论是Nor Flash还是NAND Flash，SquashFS都可以在其上运行。</li>
</ul>
<p>其中squashfs这个文件系统使用的是最广的，在我们要分析的这个固件中使用的也是squashfs。</p>
<p>继续看到嵌入式设备启动流程，前面讲到了内核挂载了文件系统。</p>
<p>内核文件加载以后，就开始运行第一个程序 &#x2F;sbin&#x2F;init，它的作用是初始化系统环境.</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230809172853758.png" alt="image-20230809172853758"></p>
<p>在squashfs的根目录下可以看到init程序是指向sbin目录下的init的。由于init是第一个运行的程序，它的进程编号（pid）就是1。其他所有进程都从它衍生，都是它的子进程。</p>
<p>在Linux下有许多开机就要运行的守护进程(daemon),init的一大作用就是去运行这些开机启动的程序，init会去读取&#x2F;etc&#x2F;inittab这个文本文件，在这个设备中如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"># /etc/inittab init(8) configuration for BusyBox</span><br><span class="line">#</span><br><span class="line"># Copyright (C) 1999-2004 by Erik Andersen &lt;andersen@codepoet.org&gt;</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line"># Note, BusyBox init doesn&#x27;t support runlevels.  The runlevels field is</span><br><span class="line"># completely ignored by BusyBox init. If you want runlevels, use sysvinit.</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line"># Format for each entry: &lt;id&gt;:&lt;runlevels&gt;:&lt;action&gt;:&lt;process&gt;</span><br><span class="line">#</span><br><span class="line"># &lt;id&gt;: WARNING: This field has a non-traditional meaning for BusyBox init!</span><br><span class="line">#</span><br><span class="line">#	The id field is used by BusyBox init to specify the controlling tty for</span><br><span class="line">#	the specified process to run on.  The contents of this field are</span><br><span class="line">#	appended to &quot;/dev/&quot; and used as-is.  There is no need for this field to</span><br><span class="line">#	be unique, although if it isn&#x27;t you may have strange results.  If this</span><br><span class="line">#	field is left blank, it is completely ignored.  Also note that if</span><br><span class="line">#	BusyBox detects that a serial console is in use, then all entries</span><br><span class="line">#	containing non-empty id fields will _not_ be run.  BusyBox init does</span><br><span class="line">#	nothing with utmp.  We don&#x27;t need no stinkin&#x27; utmp.</span><br><span class="line">#</span><br><span class="line"># &lt;runlevels&gt;: The runlevels field is completely ignored.</span><br><span class="line">#</span><br><span class="line"># &lt;action&gt;: Valid actions include: sysinit, respawn, askfirst, wait, once,</span><br><span class="line">#                                  restart, ctrlaltdel, and shutdown.</span><br><span class="line">#</span><br><span class="line">#       Note: askfirst acts just like respawn, but before running the specified</span><br><span class="line">#       process it displays the line &quot;Please press Enter to activate this</span><br><span class="line">#       console.&quot; and then waits for the user to press enter before starting</span><br><span class="line">#       the specified process.</span><br><span class="line">#</span><br><span class="line">#       Note: unrecognised actions (like initdefault) will cause init to emit</span><br><span class="line">#       an error message, and then go along with its business.</span><br><span class="line">#</span><br><span class="line"># &lt;process&gt;: Specifies the process to be executed and it&#x27;s command line.</span><br><span class="line">#</span><br><span class="line"># Note: BusyBox init works just fine without an inittab. If no inittab is</span><br><span class="line"># found, it has the following default behavior:</span><br><span class="line">#         ::sysinit:/etc/init.d/rcS</span><br><span class="line">#         ::askfirst:/bin/sh</span><br><span class="line">#         ::ctrlaltdel:/sbin/reboot</span><br><span class="line">#         ::shutdown:/sbin/swapoff -a</span><br><span class="line">#         ::shutdown:/bin/umount -a -r</span><br><span class="line">#         ::restart:/sbin/init</span><br><span class="line">#</span><br><span class="line"># if it detects that /dev/console is _not_ a serial console, it will</span><br><span class="line"># also run:</span><br><span class="line">#         tty2::askfirst:/bin/sh</span><br><span class="line">#         tty3::askfirst:/bin/sh</span><br><span class="line">#         tty4::askfirst:/bin/sh</span><br><span class="line">#</span><br><span class="line"># Boot-time system configuration/initialization script.</span><br><span class="line"># This is run first except when booting in single-user mode.</span><br><span class="line">#</span><br><span class="line">::sysinit:/bin/hostname -F /etc/hostname</span><br><span class="line">::sysinit:/etc/init.d/rcS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># /bin/sh invocations on selected ttys</span><br><span class="line">#</span><br><span class="line"># Note below that we prefix the shell commands with a &quot;-&quot; to indicate to the</span><br><span class="line"># shell that it is supposed to be a login shell.  Normally this is handled by</span><br><span class="line"># login, but since we are bypassing login in this case, BusyBox lets you do</span><br><span class="line"># this yourself...</span><br><span class="line">#</span><br><span class="line"># Start an &quot;askfirst&quot; shell on the console (whatever that may be)</span><br><span class="line"># ::askfirst:-/bin/sh</span><br><span class="line"># Start an &quot;askfirst&quot; shell on /dev/tty2-4</span><br><span class="line"># tty2::askfirst:-/bin/sh</span><br><span class="line"># tty3::askfirst:-/bin/sh</span><br><span class="line"># tty4::askfirst:-/bin/sh</span><br><span class="line"></span><br><span class="line"># /sbin/getty invocations for selected ttys</span><br><span class="line"># tty4::respawn:/sbin/getty 38400 tty5</span><br><span class="line"># tty5::respawn:/sbin/getty 38400 tty6</span><br><span class="line"></span><br><span class="line"># Example of how to put a getty on a serial line (for a terminal)</span><br><span class="line">::respawn:/sbin/getty -L ttyS000 115200 vt100 -n root -I &quot;Auto login as root&quot;</span><br><span class="line">#::respawn:-/bin/sh</span><br><span class="line">#</span><br><span class="line"># Example how to put a getty on a modem line.</span><br><span class="line">#::respawn:/sbin/getty 57600 ttyS2</span><br><span class="line"></span><br><span class="line"># Stuff to do when restarting the init process</span><br><span class="line">::restart:/sbin/init</span><br><span class="line"></span><br><span class="line"># Stuff to do before rebooting</span><br><span class="line">::ctrlaltdel:/sbin/reboot</span><br><span class="line">::shutdown:/bin/umount -a -r</span><br><span class="line">::shutdown:/sbin/swapoff -a</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>inittab文件中的值都是如下格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">label:runlevel:action:process</span><br></pre></td></tr></table></figure>

<p>比如这两行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">::sysinit:/bin/hostname -F /etc/hostname</span><br><span class="line">::sysinit:/etc/init.d/rcS</span><br></pre></td></tr></table></figure>

<p>在系统初始化时就运行hostname程序，并且运行&#x2F;etc&#x2F;init.d&#x2F;rcS这个程序。</p>
<p>接下来让我们看到&#x2F;etc&#x2F;init.d&#x2F;rcS这个程序</p>
<p>rcS实际上是一个shell脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Mount fs accroding to /etc/fstab </span></span><br><span class="line">mount -a</span><br><span class="line"></span><br><span class="line">LDCONFIG=$(<span class="built_in">type</span> -p ldconfig)</span><br><span class="line"><span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$&#123;LDCONFIG&#125;</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="variable">$&#123;LDCONFIG&#125;</span> -C /tmp/ld.so.cache</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> initscript <span class="keyword">in</span> /etc/init.d/S[0-9][0-9]*</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="keyword">if</span> [ -x <span class="variable">$initscript</span> ] ;</span><br><span class="line">	<span class="keyword">then</span></span><br><span class="line">		<span class="variable">$initscript</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f /hybroad/local.rc ]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;start user local.rc&quot;</span></span><br><span class="line">	/bin/sh /hybroad/local.rc</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Start user service if it exists</span></span><br><span class="line"><span class="keyword">if</span> [ -f /root/rc.user ]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;start user services&quot;</span></span><br><span class="line">	/bin/sh /root/rc.user</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>rcS会执行&#x2F;etc&#x2F;init.d&#x2F;下的所有以S开头的脚本文件</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230809180234370.png" alt="image-20230809180234370"></p>
<p>然后又会执行&#x2F;hybroad&#x2F;local.rc这个文件，注意到，hybroad这个目录并不是Linux的原生目录，应该是这个设备为了实现其功能而自定义的目录，需要重点关注。</p>
<p>local.rc的内容如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Export ENV</span></span><br><span class="line"><span class="built_in">export</span> TMPDIR=/var</span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="string">&quot;/lib:/usr/local/lib:/usr/lib:/usr/share/bluetooth/lib:/hybroad/lib&quot;</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;/usr/bin:/usr/sbin:/bin:/sbin:/hybroad/bin&quot;</span></span><br><span class="line"><span class="built_in">export</span> TERM=<span class="string">&#x27;vt100&#x27;</span></span><br><span class="line"><span class="built_in">export</span> TERMINFO=<span class="string">&#x27;/usr/share/terminfo&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> 64 &gt; /proc/sys/kernel/msgmni</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/kernel/auto_msgmni</span><br><span class="line"><span class="built_in">echo</span> 204800 &gt; /proc/sys/net/core/rmem_max</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$RUNLEVEL</span> ]; <span class="keyword">then</span></span><br><span class="line">    RUNLEVEL=4</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> RUNLEVEL = <span class="variable">$RUNLEVEL</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$RUNLEVEL</span> = 4 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># Mount /var</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Mount var as 80M&quot;</span></span><br><span class="line">    mount -nt tmpfs -o size=80M,mode=777 tmpfs /var</span><br><span class="line">    <span class="built_in">cd</span> /var</span><br><span class="line">    <span class="built_in">mkdir</span> lib lib/bluetooth lock <span class="built_in">log</span> run tmp dhcpc empty empty/sshd db</span><br><span class="line">    <span class="built_in">touch</span> run/utmp <span class="built_in">log</span>/wtmp</span><br><span class="line">    <span class="built_in">chmod</span> 755 empty</span><br><span class="line">    <span class="built_in">cd</span> -</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">partition_index roothome</span><br><span class="line">ROOTHOME=$?</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$ROOTHOME</span>&quot;</span> -ne 255 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;roothome=<span class="variable">$ROOTHOME</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    partition_index cache</span><br><span class="line">    ROOTHOME=$?</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$ROOTHOME</span>&quot;</span> -ne 255 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;cache=<span class="variable">$ROOTHOME</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        ROOTHOME=255</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;roothome=<span class="variable">$ROOTHOME</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$ROOTHOME</span>&quot;</span> -ne 255 ]; <span class="keyword">then</span></span><br><span class="line">    mount -t ext4 /dev/mmcblk0p<span class="variable">$ROOTHOME</span> /root</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;$?&quot;</span> != <span class="string">&quot;0&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        mke2fs -t ext4 -F /dev/mmcblk0p<span class="variable">$ROOTHOME</span></span><br><span class="line">        <span class="built_in">sleep</span> 2</span><br><span class="line">        mount -t ext4 /dev/mmcblk0p<span class="variable">$ROOTHOME</span> /root</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;mount -t ext4 /dev/mmcblk0p<span class="variable">$ROOTHOME</span> /root&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    ROOTSIZE=`<span class="built_in">df</span> | grep /dev/mmcblk0p<span class="variable">$ROOTHOME</span> | <span class="built_in">cut</span> -b 45-50`</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">mount -t ext4 /dev/mmcblk0p17 /storage</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">  mkfs.ext4 -T largefile -F  /dev/mmcblk0p17 -q</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">mount -t ext4 /dev/mmcblk0p17 /storage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">sleep</span> 1</span><br><span class="line">WIFIID=`lsusb | awk -F<span class="string">&#x27;ID &#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | fgrep <span class="string">&quot;0e8d&quot;</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$WIFIID</span>&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$WIFIID</span>&quot;</span> == <span class="string">&quot;0e8d:76a0&quot;</span> ] || [ <span class="string">&quot;<span class="variable">$WIFIID</span>&quot;</span> == <span class="string">&quot;0e8d:7662&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;insmod /kmod/mt7662u_sta.ko&quot;</span></span><br><span class="line">    insmod /kmod/mt7662u_sta.ko</span><br><span class="line">    <span class="keyword">if</span> [ -d /sys/class/net/wlan0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">touch</span> /tmp/wifi_support_5G.txt</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;No Internal WIFI Device&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -x /hybroad/bin/usbmounter ]; <span class="keyword">then</span></span><br><span class="line">    /hybroad/bin/usbmounter &amp;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">ifconfig eth0 up</span><br><span class="line">ifconfig wlan0 up</span><br><span class="line"></span><br><span class="line"><span class="built_in">touch</span> /root/.reboot</span><br><span class="line">cnt=`<span class="built_in">cat</span> /root/.reboot`</span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$&#123;cnt&#125;</span> ]; <span class="keyword">then</span></span><br><span class="line">  cnt=0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">cnt=`<span class="built_in">expr</span> <span class="variable">$&#123;cnt&#125;</span> + 1`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$cnt</span> &gt; /root/.reboot</span><br><span class="line">ifconfig | grep wlan0</span><br><span class="line"><span class="keyword">if</span> [ $? != 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;###############################REBOOT##############################&quot;</span><span class="variable">$&#123;cnt&#125;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;###############################REBOOT##############################&quot;</span><span class="variable">$&#123;cnt&#125;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;###############################REBOOT##############################&quot;</span><span class="variable">$&#123;cnt&#125;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;###############################REBOOT##############################&quot;</span><span class="variable">$&#123;cnt&#125;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;###############################REBOOT##############################&quot;</span><span class="variable">$&#123;cnt&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$&#123;cnt&#125;</span> -lt 10 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">sleep</span> 1</span><br><span class="line">    reboot -f</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;[ERROR]#######cnt &gt; 10, give up reboot, wlan0 is not up#########&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;0&quot;</span> &gt; /root/.reboot</span><br><span class="line"></span><br><span class="line">mac=`ifconfig eth0 | grep HWaddr | awk &#123;<span class="string">&#x27;print $5&#x27;</span>&#125;`</span><br><span class="line">device_search_server <span class="string">&quot;mac:&quot;</span><span class="variable">$&#123;mac&#125;</span> &amp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$RUNLEVEL</span> = 4 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Extract MicroHei.ttf to /var&quot;</span></span><br><span class="line">    tar xzf /hybroad/share/MicroHei.ttf.tar.gz -C /var</span><br><span class="line">    <span class="comment"># Start telnetd or sshd service</span></span><br><span class="line">    <span class="keyword">if</span> [ -x /usr/sbin/sshd ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Start ssh service ...&quot;</span></span><br><span class="line">        /usr/sbin/sshd</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Can not find ssh server, then use telnet server ...&quot;</span></span><br><span class="line">        telnetd 2&gt;/dev/null</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="comment"># Back upgrade tool</span></span><br><span class="line">    <span class="keyword">if</span> [ -x /hybroad/bin/back_upgrade.elf ]; <span class="keyword">then</span></span><br><span class="line">        /hybroad/bin/back_upgrade.elf &amp;</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -n <span class="variable">$RUNLEVEL</span> ; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">cd</span> /hybroad/bin</span><br><span class="line">    <span class="keyword">while</span> [ 1 ]; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$RUNLEVEL</span> <span class="keyword">in</span></span><br><span class="line">    4)</span><br><span class="line">        <span class="built_in">echo</span> Starting factory <span class="built_in">test</span> ...</span><br><span class="line">        <span class="keyword">if</span> [ -f /root/eWindow/eWindow.elf ]; <span class="keyword">then</span></span><br><span class="line">            /root/eWindow/eWindow.elf</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            /hybroad/bin/eWindow.elf</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="keyword">if</span> [ -x /hybroad/user.rc ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> Starting user.rc ...</span><br><span class="line">            /hybroad/user.rc</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            ifconfig eth0 10.0.0.188 broadcast 10.255.255.255 netmask 255.0.0.0</span><br><span class="line">            <span class="comment"># Mount /var</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Mount var as 80M&quot;</span></span><br><span class="line">            mount -nt tmpfs -o size=80M,mode=777 tmpfs /var</span><br><span class="line">            <span class="built_in">cd</span> /var</span><br><span class="line">            <span class="built_in">mkdir</span> lib lib/bluetooth lock <span class="built_in">log</span> run tmp dhcpc empty empty/sshd db</span><br><span class="line">            <span class="built_in">touch</span> run/utmp <span class="built_in">log</span>/wtmp</span><br><span class="line">            <span class="built_in">chmod</span> 755 empty</span><br><span class="line">            <span class="built_in">cd</span> -</span><br><span class="line">            <span class="comment"># Extract MicroHei.ttf</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Extract MicroHei.ttf to /var&quot;</span></span><br><span class="line">            tar xzf /hybroad/share/MicroHei.ttf.tar.gz -C /var</span><br><span class="line">            <span class="comment"># Start telnetd or sshd service</span></span><br><span class="line">            <span class="keyword">if</span> [ -x /usr/sbin/sshd ]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;Start ssh service ...&quot;</span></span><br><span class="line">                /usr/sbin/sshd</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;Can not find ssh server, then use telnet server ...&quot;</span></span><br><span class="line">                telnetd 2&gt;/dev/null</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="built_in">break</span>;</span><br><span class="line">    ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>在这个脚本中也启动了更多的进程，如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ -x /hybroad/user.rc ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> Starting user.rc ...</span><br><span class="line">    /hybroad/user.rc</span><br></pre></td></tr></table></figure>

<p>local.rc顺便启动了&#x2F;hybroad&#x2F;user.rc，user.rc用于启动用户服务，由于user.rc内容太长，在这里只截取一些我们感兴趣的部分</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230809181436931.png" alt="image-20230809181436931"></p>
<p>user.rc中启动了nginx服务。</p>
<h2 id="什么是nginx？"><a href="#什么是nginx？" class="headerlink" title="什么是nginx？"></a>什么是nginx？</h2><p><strong>Nginx (engine x) 是一个高性能的HTTP和反向代理web服务器。</strong></p>
<p>HTTP服务器我们都知道是什么，那么什么是反向代理web服务器？</p>
<p>首先，有反向就肯定有正向，我们先来看看正向代理服务器。</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/1.png" alt="1"></p>
<p><strong>正向代理：</strong> 我们平时需要访问国外的浏览器是不是很慢，比如我们要看推特，看GitHub等等。我们直接用国内的服务器无法访问国外的服务器，或者是访问很慢。所以我们需要在本地搭建一个服务器来帮助我们去访问。那这种就是正向代理。<strong>正向代理“代理”的是客户端，而且客户端是知道目标的，而目标是不知道客户端是通过VPN访问的。</strong></p>
<p>再看到反向代理：</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/2.png" alt="2"></p>
<p><strong>反向代理</strong>：那什么是反向代理呢。比如：我们访问淘宝的时候，淘宝内部肯定不是只有一台服务器，它的内部有很多台服务器，那我们进行访问的时候，因为服务器中间session不共享，那我们是不是在服务器之间访问需要频繁登录，那这个时候淘宝搭建一个过渡服务器，对我们是没有任何影响的，我们是登录一次，但是访问所有，这种情况就是 反向代理。<strong>反向代理“代理”的是服务端，对于客户端是透明的，客户端是不知道服务器内部使用了代理的，我们只需要将数据发送给服务器，由服务端进行选择即可。</strong></p>
<p>而nginx就是实现反向代理的一个服务器，能够将不同的数据转发给不同的服务进行处理。</p>
<p>nginx的配置文件为nginx.conf，路径为<code>/usr/local/nginx/conf</code>，这个配置文件一共由三部分组成，分别为<strong>全局块、events块和http块</strong>。在http块中，又包含http全局块、多个server块。每个server块中，可以包含server全局块和多个location块。在同一配置块中嵌套的配置块，各个之间不存在次序关系。</p>
<p>大致结构如下</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230809184814436.png" alt="image-20230809184814436"></p>
<p>我们重点关注http块</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230810122954192.png" alt="image-20230810122954192"></p>
<p>这里定义了http服务</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230810123051866.png" alt="image-20230810123051866"></p>
<p>定义了https服务</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230810123256608.png" alt="image-20230810123256608"></p>
<p>在这里监听了一些自定义端口，6900，6901。用于处理baiduyunpan.com域名下的请求。</p>
<p>该服务器块监听端口为6900，当收到请求时，根据请求路径进行不同的处理。</p>
<ul>
<li><code>/fsnotify</code>：当请求路径为&#x2F;fsnotify时，会执行FastCGI处理。使用include指令引入fastcgi_params配置文件，指定fastcgi_pass指令将请求转发给Unix域套接字<code>/tmp/fsnotify.sock</code>上的FastCGI后端。</li>
<li><code>/eshell</code>：当请求路径为&#x2F;eshell时，同样执行FastCGI处理。使用include指令引入fastcgi_params配置文件，指定fastcgi_pass指令将请求转发给Unix域套接字<code>/tmp/http_eshell.sock</code>上的FastCGI后端。</li>
<li><code>/baiduyunpan</code>：当请求路径为&#x2F;baiduyunpan时，执行FastCGI处理。同样使用include指令引入fastcgi_params配置文件，指定fastcgi_pass指令将请求转发给Unix域套接字<code>/tmp/baiduyunpan.sock</code>上的FastCGI后端。</li>
<li><code>/</code>：当请求路径不匹配以上任何规则时，执行默认的FastCGI处理。同样使用include指令引入fastcgi_params配置文件，指定fastcgi_pass指令将请求转发给Unix域套接字<code>/tmp/baiduyunpan.sock</code>上的FastCGI后端。</li>
</ul>
<p>我们看看<code>fsnotify.sock</code>上定义的后端是什么</p>
<p>使用如下方法命令进行全局查找</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">squashfs-root$ grep -r <span class="string">&quot;fsnotify.sock&quot;</span></span><br><span class="line">usr/local/nginx/conf/nginx.conf:        fastcgi_pass unix:/tmp/fsnotify.sock; </span><br><span class="line">usr/local/nginx/conf/nginx.conf:        fastcgi_pass unix:/tmp/fsnotify.sock; </span><br><span class="line">bin/fsnotify_guard.sh:  spawn-fcgi -n -s /tmp/fsnotify.sock -f <span class="string">&quot;/usr/sbin/fsnotify_server <span class="variable">$1</span> <span class="variable">$2</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>可以看到除了<code>nginx.conf</code>之中使用了fsnotify.sock，在<code>fsnotify_guard.sh</code>中也引用了fsnotify.sock，我们继续查找<code>fsnotify_guard.sh</code>在何处被调用了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">squashfs-root$ grep -r <span class="string">&quot;fsnotify_guard.sh&quot;</span></span><br><span class="line">usr/sbin/mqtt_run.sh:fsnotify_guard.sh <span class="variable">$&#123;name&#125;</span> <span class="variable">$&#123;psw&#125;</span> &amp;</span><br></pre></td></tr></table></figure>

<p><code>mqtt_run.sh</code>之中调用了<code>fsnotify_guard.sh</code></p>
<p>而在user.rc中</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230810124131527.png" alt="image-20230810124131527"></p>
<p>调用了<code>mqtt_run.sh</code>。</p>
<p>从上面的分析可以看出，访问6900端口的&#x2F;fsnotify路径会给到<code>/usr/sbin/fsnotify_server</code>进行处理。</p>
<p>同理，&#x2F;eshell，&#x2F;baiduyunpan也都有对应的server进行处理，这些服务在user.rc中就启动了。</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230810125906670.png" alt="image-20230810125906670"></p>
<p>到现在我们就大致理清了这个设备的运行流程：以nginx作为服务器，用户通过手机app控制云盘，不同的功能发包的目标端口不同，且访问路径不同，nginx通过访问路径和端口号来决定要使用哪个服务来处理访问请求。</p>
<p>我们可以通过burp抓包来确认自己的想法，毕竟这只是纯粹的静态分析，正不正确还不一定。</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814145646572.png" alt="image-20230814145646572"></p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814145702905.png" alt="image-20230814145702905"></p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814145739491.png" alt="image-20230814145739491"></p>
<h1 id="4-漏洞挖掘"><a href="#4-漏洞挖掘" class="headerlink" title="4.漏洞挖掘"></a>4.漏洞挖掘</h1><p>由于服务众多，本着自定义服务都可以挖的原则，直接从第一个<code>fsnotify_server</code>下手</p>
<p>main函数长这样</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230810131632105.png" alt="image-20230810131632105"></p>
<p>开头这几个<code>mosquitto</code>开头的函数，是mosquitto这个工具的api，mosquitto是什么？</p>
<p><strong>Mosquitto是一个开源的MQTT消息代理（broker），用于支持MQTT协议的消息传递。</strong></p>
<p>那么，MQTT是什么？</p>
<p>MQTT（Message Queuing Telemetry Transport）是一种轻量级的发布&#x2F;订阅消息传递协议，最初由IBM开发，并广泛用于物联网（IoT）应用中的设备间通信。它的设计目标是在低带宽和不稳定网络环境下，提供高效的消息传递机制。</p>
<p>其大致架构如下</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/3.png" alt="3"></p>
<p>发布者发布某个主题的消息，订阅者订阅某个主题的消息。</p>
<p>举个例子，比如发布者想要发布主题为“温度”的消息，如果订阅者想要接收到发布者发布的温度信息，那么就需要先在broker中订阅温度主题，这样当主题为温度的数据发送给broker时，broker就会将温度的信息转发给所有订阅了温度主题的订阅者。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mosquitto_new用于创建一个新的mqtt客户端</span><br><span class="line">mosquitto_username_pw_set用于设置Mosquitto客户端连接到MQTT代理所需的用户名和密码</span><br><span class="line">mosquitto_connect_callback_set用于设置当客户端成功连接到MQTT代理时的回调函数</span><br><span class="line">mosquitto_message_callback_set用于设置当接收到消息时的回调函数</span><br><span class="line">mosquitto_connect用于连接Mosquitto客户端到指定的MQTT代理</span><br><span class="line">mosquitto_loop_start 是一个 Mosquitto 库函数，用于启动一个线程，使 Mosquitto 客户端实例可以在后台循环处理网络和消息事件</span><br></pre></td></tr></table></figure>

<p>main函数整体如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v3; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">size_t</span> v4; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">pthread_t</span> newthread; <span class="comment">// [sp+10h] [bp-24h] BYREF</span></span><br><span class="line">  _DWORD *i; <span class="comment">// [sp+14h] [bp-20h]</span></span><br><span class="line">  <span class="type">char</span> *newa; <span class="comment">// [sp+18h] [bp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [sp+1Ch] [bp-18h]</span></span><br><span class="line">  FILE *v10; <span class="comment">// [sp+20h] [bp-14h]</span></span><br><span class="line">  <span class="type">char</span> *s; <span class="comment">// [sp+24h] [bp-10h]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [sp+28h] [bp-Ch]</span></span><br><span class="line">  FILE *stream; <span class="comment">// [sp+2Ch] [bp-8h]</span></span><br><span class="line"></span><br><span class="line">  sub_12FF4();</span><br><span class="line">  mosq = mosquitto_new(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);<span class="comment">//创建一个新的mqtt客户端</span></span><br><span class="line">  mosquitto_username_pw_set(mosq, a2[<span class="number">1</span>], a2[<span class="number">2</span>]);<span class="comment">//设置连接用户名和密码</span></span><br><span class="line">  mosquitto_connect_callback_set(mosq, sub_14988);<span class="comment">//设置连接成功时的回调函数</span></span><br><span class="line">  mosquitto_message_callback_set(mosq, sub_147F0);<span class="comment">//设置接收到消息时的回调函数</span></span><br><span class="line">  <span class="keyword">if</span> ( mosquitto_connect(mosq, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">1883</span>, <span class="number">120</span>) )<span class="comment">//连接mqtt代理</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( off_44A8C )</span><br><span class="line">    &#123;</span><br><span class="line">      stream = (FILE *)fopen64(off_44A8C, <span class="string">&quot;a+&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> ( stream )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(</span><br><span class="line">          stream,</span><br><span class="line">          <span class="string">&quot;time:%s, file:%s, line:%d, func:%s, info:mqtt connect failed\n&quot;</span>,</span><br><span class="line">          <span class="string">&quot;Wed Oct 19 09:29:28 2022&quot;</span>,</span><br><span class="line">          <span class="string">&quot;server.c&quot;</span>,</span><br><span class="line">          <span class="number">1716</span>,</span><br><span class="line">          <span class="string">&quot;main&quot;</span>);</span><br><span class="line">        v12 = ftell(stream);</span><br><span class="line">        fclose(stream);</span><br><span class="line">        <span class="keyword">if</span> ( v12 &gt; <span class="number">0x800000</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v3 = <span class="built_in">strlen</span>(off_44A8C);</span><br><span class="line">          s = (<span class="type">char</span> *)<span class="built_in">malloc</span>(v3 + <span class="number">2</span>);</span><br><span class="line">          <span class="built_in">sprintf</span>(s, <span class="string">&quot;%s0&quot;</span>, off_44A8C);</span><br><span class="line">          rename(off_44A8C, s);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( mosquitto_loop_start(mosq) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( off_44A8C )</span><br><span class="line">    &#123;</span><br><span class="line">      v10 = (FILE *)fopen64(off_44A8C, <span class="string">&quot;a+&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> ( v10 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(</span><br><span class="line">          v10,</span><br><span class="line">          <span class="string">&quot;time:%s, file:%s, line:%d, func:%s, info:mosq_loop_start failed\n&quot;</span>,</span><br><span class="line">          <span class="string">&quot;Wed Oct 19 09:29:28 2022&quot;</span>,</span><br><span class="line">          <span class="string">&quot;server.c&quot;</span>,</span><br><span class="line">          <span class="number">1721</span>,</span><br><span class="line">          <span class="string">&quot;main&quot;</span>);</span><br><span class="line">        v9 = ftell(v10);</span><br><span class="line">        fclose(v10);</span><br><span class="line">        <span class="keyword">if</span> ( v9 &gt; <span class="number">0x800000</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v4 = <span class="built_in">strlen</span>(off_44A8C);</span><br><span class="line">          newa = (<span class="type">char</span> *)<span class="built_in">malloc</span>(v4 + <span class="number">2</span>);</span><br><span class="line">          <span class="built_in">sprintf</span>(newa, <span class="string">&quot;%s0&quot;</span>, off_44A8C);</span><br><span class="line">          rename(off_44A8C, newa);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    pthread_create(&amp;newthread, <span class="number">0</span>, (<span class="type">void</span> *(*)(<span class="type">void</span> *))start_routine, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( i = sub_2E21C(<span class="number">64</span>, (<span class="type">int</span>)sub_19600, (<span class="type">int</span>)sub_19758, <span class="number">0</span>); ; sub_2E2AC(i, <span class="number">-1</span>) )<span class="comment">//最后得执行这个奇怪的for循环</span></span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看到<code>sub_2E21C</code>函数</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230810150210199.png" alt="image-20230810150210199"></p>
<p>都是赋值的操作，意义不明，只看到最后一个<code>FCGX_Init</code>函数。</p>
<p>再看到<code>sub_19600</code>函数</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230810152643683.png" alt="image-20230810152643683"></p>
<p>也使用了FCGX_FPrintF。</p>
<p>谷歌一下。</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230810151240397.png" alt="image-20230810151240397"></p>
<p>下载源码编译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir install</span><br><span class="line">./configure --prefix=./install</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230810153307313.png" alt="image-20230810153307313"></p>
<p>然后生成这3个目录，我们看到lib目录</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230810153357415.png" alt="image-20230810153357415"></p>
<p>用IDA打开<code>libfcgi.so.0.0.0</code>这个文件</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230810153916041.png" alt="image-20230810153916041"></p>
<p>然后生成C头文件</p>
<p>然后再载入头文件</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230810154351851.png" alt="image-20230810154351851"></p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230810154506619.png" alt="image-20230810154506619"></p>
<p>可以看到导入了不少结构体，接下来我们来恢复一下函数的参数，方便我们查看</p>
<p>比如这个<code>FCGX_FPrintF</code>，第一个参数看起来是个结构体，</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230810155052528.png" alt="image-20230810155052528"></p>
<p>其函数原型如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">FCGX_FPrintF</span><span class="params">(FCGX_Stream *stream, <span class="type">const</span> <span class="type">char</span> *format, ...)</span></span><br></pre></td></tr></table></figure>

<p>还有下面的</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230811123209846.png" alt="image-20230811123209846"></p>
<p>函数原型如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *<span class="title function_">FCGX_GetParam</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name, FCGX_ParamArray envp)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">FCGX_GetStr</span><span class="params">(<span class="type">char</span> *str, <span class="type">int</span> n, FCGX_Stream *stream)</span>;</span><br></pre></td></tr></table></figure>

<p>但是注意到在伪代码中FCGX_GetParam和FCGX_GetStr的参数都是<code>a1+x</code>的形式，也就是说FCGX_GetParam和FCGX_GetStr的参数都是a1中的某个成员，即FCGX_ParamArray和FCGX_Stream这两个结构体指针是另外一个结构体的成员。</p>
<p>在源码中进行查找，找到了符合的结构体</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">FCGX_Request</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> requestId;            <span class="comment">/* valid if isBeginProcessed */</span></span><br><span class="line">    <span class="type">int</span> role;</span><br><span class="line">    FCGX_Stream *in;</span><br><span class="line">    FCGX_Stream *out;</span><br><span class="line">    FCGX_Stream *err;</span><br><span class="line">	<span class="type">char</span> **envp;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Don&#x27;t use anything below here */</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Params</span> *<span class="title">paramsPtr</span>;</span></span><br><span class="line">    <span class="type">int</span> ipcFd;               <span class="comment">/* &lt; 0 means no connection */</span></span><br><span class="line">    <span class="type">int</span> isBeginProcessed;     <span class="comment">/* FCGI_BEGIN_REQUEST seen */</span></span><br><span class="line">    <span class="type">int</span> keepConnection;       <span class="comment">/* don&#x27;t close ipcFd at end of request */</span></span><br><span class="line">    <span class="type">int</span> appStatus;</span><br><span class="line">    <span class="type">int</span> nWriters;             <span class="comment">/* number of open writers (0..2) */</span></span><br><span class="line">	<span class="type">int</span> flags;</span><br><span class="line">	<span class="type">int</span> listen_sock;</span><br><span class="line">&#125; FCGX_Request;</span><br></pre></td></tr></table></figure>

<p>将a1重新设置类型，如下图所示</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230811124016748.png" alt="image-20230811124016748"></p>
<p>FCGX_GetParam和FCGX_GetStr的参数都已发生了变化</p>
<p>再对其他fcgi的函数进行一些参数修改即可。</p>
<p>再回头看main</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230811125436995.png" alt="image-20230811125436995"></p>
<p>修改之后的for循环发生了一点变化，还是看到<code>sub_19600</code>函数</p>
<p>先看到<code>sub_2E428</code>函数</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230811125913848.png" alt="image-20230811125913848"></p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230811125644886.png" alt="image-20230811125644886"></p>
<p>获取<code>CONTENT_LENGTH</code>的值，然后再获取contentlength长度的content</p>
<p>将函数的变量和函数名重命名一下</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230811125823240.png" alt="image-20230811125823240"></p>
<p>最后返回的是存储着content的数据的堆块的指针。</p>
<p>再看到<code>sub_1BA4C</code>函数</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230811130322885.png" alt="image-20230811130322885"></p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230811130414701.png" alt="image-20230811130414701"></p>
<p>出现了另一个函数<code>protobuf_c_message_unpack</code></p>
<p>这个函数属于一个反序列化框架protobuf</p>
<p><strong>Protobuf (Protocol Buffers) 是谷歌开发的一款无关平台，无关语言，可扩展，轻量级高效的序列化结构的数据格式，用于将自定义数据结构序列化成字节流，和将字节流反序列化为数据结构。</strong></p>
<p>protobuf支持许多语言，其中就包含c语言。protobuf-c也是开源的，既然是开源的，我们也还是扒拉下源码然后编译，然后导入结构体，以便于我们逆向分析。</p>
<p>安装protobuf-c之前需要先安装protobuf</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install autoconf automake libtool curl make g++ unzip -y</span><br><span class="line">wget https://github.com/protocolbuffers/protobuf/releases/download/v21.11/protobuf-all-21.11.zip</span><br><span class="line">unzip protobuf-all-21.11.zip</span><br><span class="line"><span class="built_in">cd</span> protobuf-21.11</span><br><span class="line">./autogen.sh</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line">sudo ldconfig</span><br></pre></td></tr></table></figure>

<p>然后继续安装protobuf-c</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/protobuf-c/protobuf-c.git</span><br><span class="line"><span class="built_in">cd</span> protobuf-c</span><br><span class="line">./configure &amp;&amp; make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>安装成功之后有如下几个目录</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230811141411871.png" alt="image-20230811141411871"></p>
<p>在lib目录下</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230811141449986.png" alt="image-20230811141449986"></p>
<p>把<code>libprotobuf-c.so.1.0.0</code>丢入IDA，导出结构体。</p>
<p>注意，导入结构体后需要修改一下size_t的大小为__int32</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> __int32 <span class="type">size_t</span>;</span><br></pre></td></tr></table></figure>

<p>protobuf_c_message_unpack的函数原型如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">protobuf_c_message_unpack(</span><br><span class="line">	<span class="type">const</span> ProtobufCMessageDescriptor *descriptor,</span><br><span class="line">	ProtobufCAllocator *allocator,</span><br><span class="line">	<span class="type">size_t</span> len,</span><br><span class="line">	<span class="type">const</span> <span class="type">uint8_t</span> *data);</span><br></pre></td></tr></table></figure>

<p>然后将IDA中的函数的变量重新设置</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230811151335218.png" alt="image-20230811151335218"></p>
<p>不光<code>protobuf_c_message_unpack</code>，还有其他protobuf-c的函数也一并重新设置变量类型</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230811145941211.png" alt="image-20230811145941211"></p>
<p>看到<code>sub_21328</code>函数</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230811151501754.png" alt="image-20230811151501754"></p>
<p>看起来是对json数据进行解析的函数</p>
<p>跟入到<code>sub_212C8</code>函数</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230811151733045.png" alt="image-20230811151733045"></p>
<p>发现了<code>json_object_iter_key</code>等函数，还是Google一下</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230811151832679.png" alt="image-20230811151832679"></p>
<p>发现是这个开源库，依然是老样子，源码编译恢复符号表</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/akheron/jansson.git</span><br><span class="line"><span class="built_in">cd</span> jansson</span><br><span class="line">autoreconf -i</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>恢复后如下所示</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230811153721454.png" alt="image-20230811153721454"></p>
<p>经过上面的重命名之后，再看回到<code>sub_19600</code>函数</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230811155748167.png" alt="image-20230811155748167"></p>
<p>关注一下这个<code>descriptor</code>，其类型是<code>ProtobufCMessageDescriptor</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ProtobufCMessageDescriptor</span> &#123;</span></span><br><span class="line">	<span class="comment">/** Magic value checked to ensure that the API is used correctly. */</span></span><br><span class="line">	<span class="type">uint32_t</span>			magic;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** The qualified name (e.g., &quot;namespace.Type&quot;). */</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span>			*name;</span><br><span class="line">	<span class="comment">/** The unqualified name as given in the .proto file (e.g., &quot;Type&quot;). */</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span>			*short_name;</span><br><span class="line">	<span class="comment">/** Identifier used in generated C code. */</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span>			*c_name;</span><br><span class="line">	<span class="comment">/** The dot-separated namespace. */</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span>			*package_name;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Size in bytes of the C structure representing an instance of this</span></span><br><span class="line"><span class="comment">	 * type of message.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">size_t</span>				sizeof_message;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Number of elements in `fields`. */</span></span><br><span class="line">	<span class="type">unsigned</span>			n_fields;</span><br><span class="line">	<span class="comment">/** Field descriptors, sorted by tag number. */</span></span><br><span class="line">	<span class="type">const</span> ProtobufCFieldDescriptor	*fields;</span><br><span class="line">	<span class="comment">/** Used for looking up fields by name. */</span></span><br><span class="line">	<span class="type">const</span> <span class="type">unsigned</span>			*fields_sorted_by_name;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Number of elements in `field_ranges`. */</span></span><br><span class="line">	<span class="type">unsigned</span>			n_field_ranges;</span><br><span class="line">	<span class="comment">/** Used for looking up fields by id. */</span></span><br><span class="line">	<span class="type">const</span> ProtobufCIntRange		*field_ranges;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Message initialisation function. */</span></span><br><span class="line">	ProtobufCMessageInit		message_init;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Reserved for future use. */</span></span><br><span class="line">	<span class="type">void</span>				*reserved1;</span><br><span class="line">	<span class="comment">/** Reserved for future use. */</span></span><br><span class="line">	<span class="type">void</span>				*reserved2;</span><br><span class="line">	<span class="comment">/** Reserved for future use. */</span></span><br><span class="line">	<span class="type">void</span>				*reserved3;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230811160103536.png" alt="image-20230811160103536"></p>
<p>这个结构体用于描述和表示一个Protocol Buffers消息类型。</p>
<p>根据这个结构体，我们可以得出很多信息</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814144717091.png" alt="image-20230814144717091"></p>
<p>这四个数据分别对应着magic，name，short_name和c_name。</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814144855125.png" alt="image-20230814144855125"></p>
<p>而下面的这些数据，挑一点重要的来讲，<code>0x30</code>表示根据这个protobuf消息类型实例化的c语言结构体的大小为0x30字节。</p>
<p>7表示fields数组的数量，fields数组是标签号排序的字段描述符数组，用于说明结构体中的各个字段的类型大小等等，fields数组的类型是</p>
<p><code>ProtobufCFieldDescriptor	*</code>，我们看到fields数组：</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814145519381.png" alt="image-20230814145519381"></p>
<p><code>ProtobufCFieldDescriptor</code>的定义如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ProtobufCFieldDescriptor</span> &#123;</span></span><br><span class="line">	<span class="comment">/** Name of the field as given in the .proto file. */</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span>		*name;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Tag value of the field as given in the .proto file. */</span></span><br><span class="line">	<span class="type">uint32_t</span>		id;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Whether the field is `REQUIRED`, `OPTIONAL`, or `REPEATED`. */</span></span><br><span class="line">	ProtobufCLabel		label;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** The type of the field. */</span></span><br><span class="line">	ProtobufCType		type;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The offset in bytes of the message&#x27;s C structure&#x27;s quantifier field</span></span><br><span class="line"><span class="comment">	 * (the `has_MEMBER` field for optional members or the `n_MEMBER` field</span></span><br><span class="line"><span class="comment">	 * for repeated members or the case enum for oneofs).</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">unsigned</span>		quantifier_offset;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The offset in bytes into the message&#x27;s C structure for the member</span></span><br><span class="line"><span class="comment">	 * itself.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">unsigned</span>		offset;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * A type-specific descriptor.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * If `type` is `PROTOBUF_C_TYPE_ENUM`, then `descriptor` points to the</span></span><br><span class="line"><span class="comment">	 * corresponding `ProtobufCEnumDescriptor`.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * If `type` is `PROTOBUF_C_TYPE_MESSAGE`, then `descriptor` points to</span></span><br><span class="line"><span class="comment">	 * the corresponding `ProtobufCMessageDescriptor`.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Otherwise this field is NULL.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">const</span> <span class="type">void</span>		*descriptor; <span class="comment">/* for MESSAGE and ENUM types */</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** The default value for this field, if defined. May be NULL. */</span></span><br><span class="line">	<span class="type">const</span> <span class="type">void</span>		*default_value;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * A flag word. Zero or more of the bits defined in the</span></span><br><span class="line"><span class="comment">	 * `ProtobufCFieldFlag` enum may be set.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint32_t</span>		flags;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Reserved for future use. */</span></span><br><span class="line">	<span class="type">unsigned</span>		reserved_flags;</span><br><span class="line">	<span class="comment">/** Reserved for future use. */</span></span><br><span class="line">	<span class="type">void</span>			*reserved2;</span><br><span class="line">	<span class="comment">/** Reserved for future use. */</span></span><br><span class="line">	<span class="type">void</span>			*reserved3;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814150356075.png" alt="image-20230814150356075"></p>
<p>开头的version，username，token等等字符串就是发包时需要的参数，这一点在我们抓取到的网络包中可以看出来</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814150504434.png" alt="image-20230814150504434"></p>
<p><code>PROTOBUF_C_LABEL_NONE</code>是在protobuf-c库中定义的一个枚举常量，用于表示Protocol Buffers消息字段的标签类型。</p>
<p>在protobuf-c库中，字段标签类型可以是以下之一：</p>
<ul>
<li><code>PROTOBUF_C_LABEL_REQUIRED</code>：表示字段是必需的，每个消息实例都必须包含该字段。</li>
<li><code>PROTOBUF_C_LABEL_OPTIONAL</code>：表示字段是可选的，每个消息实例可以选择包含该字段。</li>
<li><code>PROTOBUF_C_LABEL_REPEATED</code>：表示字段是可重复的，每个消息实例可以包含多个该字段的值。</li>
</ul>
<p>而<code>PROTOBUF_C_LABEL_NONE</code>则表示字段没有标签类型，即该字段无效或未设置标签类型。</p>
<p>可以看到，在七个数组元素中</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814150700887.png" alt="image-20230814150700887"></p>
<p>只有params这个元素是可以重复的，那么这个重复是怎么体现出来的，还是看到我们上面抓的包</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814150805176.png" alt="image-20230814150805176"></p>
<p>也就是字符串数组的形式。</p>
<p>注意到，在cmd这个元素中，有一个地址引起了我们的关注</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814153258180.png" alt="image-20230814153258180"></p>
<p>这里对应的是<code>ProtobufCFieldDescriptor</code>中的descriptor成员</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * A type-specific descriptor.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * If `type` is `PROTOBUF_C_TYPE_ENUM`, then `descriptor` points to the</span></span><br><span class="line"><span class="comment">	 * corresponding `ProtobufCEnumDescriptor`.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * If `type` is `PROTOBUF_C_TYPE_MESSAGE`, then `descriptor` points to</span></span><br><span class="line"><span class="comment">	 * the corresponding `ProtobufCMessageDescriptor`.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Otherwise this field is NULL.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">const</span> <span class="type">void</span>		*descriptor; <span class="comment">/* for MESSAGE and ENUM types */</span></span><br></pre></td></tr></table></figure>

<p>如果类型是<code>PROTOBUF_C_TYPE_ENUM</code>，那么<code>descriptor</code>就是指向<code>ProtobufCEnumDescriptor</code>类型的指针变量。</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814153810656.png" alt="image-20230814153810656"></p>
<p>我们将这一段设置为<code>ProtobufCEnumDescriptor</code>类型，</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814155244975.png" alt="image-20230814155244975"></p>
<p><code>ProtobufCEnumDescriptor</code>定义如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ProtobufCEnumDescriptor</span> &#123;</span></span><br><span class="line">	<span class="comment">/** Magic value checked to ensure that the API is used correctly. */</span></span><br><span class="line">	<span class="type">uint32_t</span>			magic;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** The qualified name (e.g., &quot;namespace.Type&quot;). */</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span>			*name;</span><br><span class="line">	<span class="comment">/** The unqualified name as given in the .proto file (e.g., &quot;Type&quot;). */</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span>			*short_name;</span><br><span class="line">	<span class="comment">/** Identifier used in generated C code. */</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span>			*c_name;</span><br><span class="line">	<span class="comment">/** The dot-separated namespace. */</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span>			*package_name;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Number elements in `values`. */</span></span><br><span class="line">	<span class="type">unsigned</span>			n_values;</span><br><span class="line">	<span class="comment">/** Array of distinct values, sorted by numeric value. */</span></span><br><span class="line">	<span class="type">const</span> ProtobufCEnumValue	*values;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Number of elements in `values_by_name`. */</span></span><br><span class="line">	<span class="type">unsigned</span>			n_value_names;</span><br><span class="line">	<span class="comment">/** Array of named values, including aliases, sorted by name. */</span></span><br><span class="line">	<span class="type">const</span> ProtobufCEnumValueIndex	*values_by_name;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Number of elements in `value_ranges`. */</span></span><br><span class="line">	<span class="type">unsigned</span>			n_value_ranges;</span><br><span class="line">	<span class="comment">/** Value ranges, for faster lookups by numeric value. */</span></span><br><span class="line">	<span class="type">const</span> ProtobufCIntRange		*value_ranges;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Reserved for future use. */</span></span><br><span class="line">	<span class="type">void</span>				*reserved1;</span><br><span class="line">	<span class="comment">/** Reserved for future use. */</span></span><br><span class="line">	<span class="type">void</span>				*reserved2;</span><br><span class="line">	<span class="comment">/** Reserved for future use. */</span></span><br><span class="line">	<span class="type">void</span>				*reserved3;</span><br><span class="line">	<span class="comment">/** Reserved for future use. */</span></span><br><span class="line">	<span class="type">void</span>				*reserved4;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814155302130.png" alt="image-20230814155302130"></p>
<p>其中的values就是cmd这个字段的可选值，这个values的类型为<code>ProtobufCEnumValue</code></p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814155357530.png" alt="image-20230814155357530"></p>
<p>cmd的可选值一共有27种，在其中我们注意到两个敏感的词</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814155738949.png" alt="image-20230814155738949"></p>
<p>system和popen作为两个危险函数需要格外关注，而在这里出现在了cmd的可选值中，是不是意味着有对应的函数能够执行类似system和popen的功能？</p>
<p>那么，这些个功能在哪里执行，对应的函数又是怎么样的？继续看回到<code>sub_19600</code>函数</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814214523177.png" alt="image-20230814214523177"></p>
<p>在这里有一个函数表的调用</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814214807135.png" alt="image-20230814214807135"></p>
<p>正好是27个函数，我们可以推断，这里的27个函数对应着cmd可以执行的27个功能</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814214912946.png" alt="image-20230814214912946"></p>
<p>而popen和system功能正好是倒数第2个第3个功能，我们在函数表中查看一下倒数第二和倒数第三个函数</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814215120581.png" alt="image-20230814215120581"></p>
<p>如我们所见，倒数第二个函数确实使用了popen来执行命令，这个命令来自于哪里？</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814215512325.png" alt="image-20230814215512325"></p>
<p>偏移0x20处，要知道，传入到函数中的参数是一个结构体，在上面已经讲过了</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20230814215633480.png" alt="image-20230814215633480"></p>
<p>而param位于这个结构体的偏移为0x20处，所以传入popen的参数实际上就是param的值，如果我们控制了param的值就能够使用popen来进行任意命令执行。</p>
<p>这是第一个漏洞。</p>
<p>有了命令执行，如果不能够未授权执行那依然相当鸡肋。</p>
<p>我们可以看到，在整个执行过程中并没有任何校验的代码，哪怕结构体中有<code>username</code>和<code>token</code>，但其类型也是<code>PROTOBUF_C_LABEL_NONE</code>，即传参过程中可有可无，所以即使我们只发送一个param过去也依然能够被程序正常处理，这样就能够导致未授权的RCE。</p>
<p>shell如下</p>
<p><img src="https://raw.githubusercontent.com/LindLL/blog-img/main/image-20240109205119969.png" alt="image-20240109205119969"></p>

  </div>
  <!--文末结束语-->
  
    <div style="text-align:center;color: #ccc;font-size:24px;"> --- 本文结束 <i class="iconfont icon-heartbeat" style="font-size:24px;"></i> The End --- </div>
  
  <!--页脚广告-->
  
  <div class="mdui-divider"></div>
  
  <nav>
    
      <a rel="prev" class="post-nav-item mdui-float-left" href="/2024/01/09/%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/">
        <i class="iconfont icon-angle-left"></i>
        <span>刷题记录</span>
      </a>
    
    
      <a rel="next" class="post-nav-item mdui-float-right" href="/2024/01/09/TS3480%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/">
        <span>TS3480折腾记录</span>
        <i class="iconfont icon-angle-right"></i>
      </a>
    
  </nav>
</article>




  <div class="toc-button"  style="z-index: 100;">
    <button class="mdui-fab mdui-ripple mdui-color-teal" mdui-menu="{target: '#toc'}"><i class="iconfont icon-list"></i></button>
    <ul class="mdui-menu" id="toc">
      <li class="mdui-menu-item">
        <a href="/2024/01/09/%E6%9F%90%E4%BA%91%E7%9B%98%E5%88%86%E6%9E%90/" id="toc-header" class="mdui-ripple">Table of Contents</a>
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E6%94%BB%E5%87%BB%E9%9D%A2%E5%88%86%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">1.攻击面分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%9B%BA%E4%BB%B6%E8%8E%B7%E5%8F%96"><span class="toc-number">2.</span> <span class="toc-text">2.固件获取</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">3.固件分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B5%8C%E5%85%A5%E5%BC%8FLinux%E7%9A%84%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B"><span class="toc-number">3.1.</span> <span class="toc-text">嵌入式Linux的启动流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%EF%BC%9F"><span class="toc-number">3.1.1.</span> <span class="toc-text">什么是文件系统？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFnginx%EF%BC%9F"><span class="toc-number">3.2.</span> <span class="toc-text">什么是nginx？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98"><span class="toc-number">4.</span> <span class="toc-text">4.漏洞挖掘</span></a></li></ol>
      </li>
    </ul>
  </div>



    <div id="comment" class="mdui-card mdui-p-a-2 mdui-m-b-5">
      <div class="mdui-tab" mdui-tab>
        
          <a href="#comment-tab0" class="mdui-ripple">gitalk</a>
        
          <a href="#comment-tab1" class="mdui-ripple">livere</a>
        
      </div>
      
        <div id="comment-tab0" class="mdui-p-a-2">
          <div id="gitalk-container"></div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/js-md5@0.7.3/src/md5.min.js"></script>
<script>
  var gitalk = new Gitalk({
    clientID: '',
    clientSecret: '',
    repo: '',
    owner: '',
    admin: [''],
    id:  md5(location.pathname) ,
    distractionFreeMode: 'true',
  });
  gitalk.render('gitalk-container');
</script>
        </div>
      
        <div id="comment-tab1" class="mdui-p-a-2">
          <div id="lv-container" data-id="city" data-uid="">
  <script type="text/javascript">
    (function (d, s) {
      var j, e = d.getElementsByTagName(s)[0];
      if (typeof LivereTower === 'function') { return; }
      j = d.createElement(s);
      j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
      j.async = true;
      e.parentNode.insertBefore(j, e);
    })(document, 'script');
  </script>
  <noscript>Please enable JavaScript to view the comments powered by LiveRe.</noscript>
</div>
        </div>
      
    </div>

  </main>
  <footer id="footer" class="mdui-text-center mdui-m-t-5 mdui-p-b-2 mdui-p-t-4 mdui-color-theme">
  <div class="mdui-container">
    <div class="mdui-row">
      
        <a href="https://beian.miit.gov.cn" rel="noopener" target="_blank"></a>
      
      <span>
        &copy; 2015 - 2024 
        
          <span style="color:#d9333f" class="iconfont icon-heart"></span>
        
        John Doe
      </span>
    </div>
    <div class="mdui-row">
      
        <div class="mdui-col-xs-6 mdui-text-right">
          <span>Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a></span>
        </div>
        <div class="mdui-col-xs-6 mdui-text-left">
          <span>Theme: <a href="https://github.com/kb1000fx/Meadow" rel="noopener" target="_blank">Meadow</a></span>
        </div>
      
    </div>
    <div class="mdui-row">
      
        <div class="mdui-col-xs-6 mdui-text-right">
          <span id="busuanzi_container_site_uv" style="display: none;"> <span class="iconfont icon-user"></span>Total Visitors <span id="busuanzi_value_site_uv"></span></span>
        </div>
        <div class="mdui-col-xs-6 mdui-text-left">
          <span id="busuanzi_container_site_pv" style="display: none;"> <span class="iconfont icon-eye"></span>Total Views <span id="busuanzi_value_site_pv"></span></span>
        </div>
      
    </div>
 </div>
</footer>
  
  <button id="gotop" class="mdui-fab mdui-fab-fixed mdui-fab-hide mdui-ripple mdui-color-teal" style="z-index:100;"><i class="iconfont icon-arrowup"></i></button>
  
  

    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




    <script src="https://cdn.jsdelivr.net/npm/mermaid@8.4.8/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({
        startOnLoad: true,
        theme: "default"
    });</script>




    
<script src="/js/mdui.min.v1.0.0.js"></script>




<script src="/js/meadow.js"></script>

</body>
</html >